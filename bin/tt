#!/usr/bin/env python
import sys
import tt



def init(manager):
    manager.initialize_state()

def add(manager, name):
    manager.add_task(name)

def status(manager):
    for status in ('started', 'stopped', 'pending', 'done'):
        print status.upper()
        tasks = manager.get_tasks_by_status(status)
        for task in tasks:
            if status == "done":
                pretty_duration = task.get_pretty_total_duration()
                print "%s (%s)" % (task.name, pretty_duration)
            else:
                print task.name
        print

def start(manager, task_id):
    task = manager.get_task(task_id)
    manager.start_task(task)

def stop(manager, task_id):
    task = manager.get_task(task_id)
    manager.stop_task(task)

def done(manager, task_id):
    task = manager.get_task(task_id)
    manager.done_task(task)

def usage():
    cmd = "tt"
    print "%s <init|add|status>" % cmd

def main():
    if len(sys.argv) < 2:
        usage()
        sys.exit(1)

    TESTDIR = "/tmp/ttfunctest"
    tt.TaskManager.TT_DIR = TESTDIR
    manager = tt.TaskManager()

    action = sys.argv[1]
    if action == "init":
        init(manager)
    elif action == "add":
        name = sys.argv[2]
        add(manager, name)
    elif action == "status":
        status(manager)
    elif action == "start":
        task_id = sys.argv[2]
        start(manager, task_id)
    elif action == "stop":
        task_id = sys.argv[2]
        stop(manager, task_id)
    elif action == "done":
        task_id = sys.argv[2]
        done(manager, task_id)

if __name__ == "__main__":
    main()
